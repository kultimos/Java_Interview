# kafka的副本follower和leader出现故障时,都是如何解决的
  无论是leader还是follower,都依赖于HW(所有副本中最小的LEO)和LEO(每个副本的最后一个offset);
  
  - 如果Broker1上的follower副本故障,那么它会立刻被踢出ISR队列,但不会影响leader和其他follower继续服务和更新数据,对应的LEO和HW都会继续更迭,如果一段时间后,宕机的follower恢复,
那么此时follower会去本地磁盘读取最新一次的HW记录,然后检查自己的log文件,将文件中高于HW的部分截掉,然后开始根据HW从leader处同步数据,直到该follower的LEO大于等于该分区的HW,说明
这个宕机的follower恢复后已经将掉线时缺少的数据补齐,那么此时可以将其重新加入ISR队列中;

  - 如果leader副本故障,那么它会被立刻提出ISR队列,然后会在AR中按顺序找到第一个存货的follower,检查其是否在ISR队列中,若在,则升级为leader节点,然后检查所有副本的LEO,将其与整个分区
的HW进行比对,将超出HW的部分全部截去,以此来保证副本之间的数据一致性,但是注意,这里是不能保证数据的不丢失或不重复,即无法完全保证数据一致性;这里就取决于我们的参数配置,如果我们配置的是需要
将数据同步至所有分区,ack也需要all,那么即使出现了leader宕机,我们也可以保证数据一致性,但凡不是,但凡我们为了考虑可用性而减少了follower的数据写入确认数量,就有数据不一致的风险;
[后面这段话的理解见](8.kafka遵循着cap原则吗.md)