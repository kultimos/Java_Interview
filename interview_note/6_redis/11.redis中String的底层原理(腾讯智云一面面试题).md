# redis中String的底层原理(腾讯智云一面面试题)
  redis中的String数据结构底层原理是通过简单动态字符串(SDS)来实现的,简单动态字符是redis自己实现的一种字符串类型,与C语言的字符串想比,它具有更多的功能和优势
  简单动态字符串的结构如下:
    plaintextCopy codestruct sdshdr {
        int len;       //已使用的长度
        int free;      //剩余的空间
        char buf[];    //实际存储的字符数组
}
  简单动态字符串SDS的特点如下:
  - O(1)复杂度获取字符串长度
  - 杜绝缓冲区溢出,因为free字段记录了剩余的空间,当需要对字符串进行修改时,可以根据需要进行内存的扩展或收缩,避免了缓冲区溢出的问题
  - 二进制安全,buf[]是一个字符数组,可以存任何二进制数据,因此可以处理任意类型的数据,而不仅仅是字符串;
    传统的C语言字符串(以\0结尾的字符数组)存在一个限制,即不能包含字符\0,因为\0会被视为字符串的结束符,这使得传统字符串无法直接处理包含\0的二进制数据或者
  特殊字符的数据;而SDS克服了这个限制,它可以存储任何二进制数据,因为SDS内部并不依赖于\0结尾来判断字符串结束;
  - 兼容部分C字符串函数: buf[]虽然不会将'\0'视为字符串结束标志,但是也确实是以'\0'结尾的,所以可以使用一些C字符串函数进行操作


  ## string的三种编码方式
  - int
    - redis在启动时会预先建立10000个分别存储0~9999的redisObject变量作为共享对象,这意味着如果set字符串的键值在0~10000之间的话,可以直接指向
    redis共享池中,而不需要再新建立对象
    - 只有整数才会使用int编码方式进行存储,如果是浮点数,会现将其转为字符串值,然后在保存
  - embstr
    - 保存长度小于44字节的字符串
    - embstr中存储的redisObject对象和实际存储字符串的SDS结构体是连续分配的一块内存,所以也称其为嵌入式字符串
    - embstr字符串是只读的,所以在对embstr字符串进行修改时,会将其转为raw
  - raw
    - 保存长度大于44字节的字符串
    - embstr字符串被修改,也会转用raw进行存储